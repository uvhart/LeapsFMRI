!function(e){"function"==typeof define&&define.amd?define(["q"],function(t){return e(XMLHttpRequest,t)}):"object"==typeof exports&&"object"==typeof module?module.exports=e:"undefined"!=typeof Q&&e(XMLHttpRequest,Q)}(function(e,t){function n(e){return Array.prototype.forEach.call(arguments,function(t){t&&t!==e&&Object.keys(t).forEach(function(n){e[n]=t[n]})}),e}function r(e){return(e||"").toLowerCase()}function o(e){var t="object"==typeof e?e:void 0;return function(n){var o,s,u,i,a;return t||(a={},t=(o=e)?(o.split("\n").forEach(function(e){i=e.indexOf(":"),s=r(e.substr(0,i).trim()),u=e.substr(i+1).trim(),s&&(a[s]?a[s]+=", "+u:a[s]=u)}),a):a),n?t[r(n)]:t}}function s(e,t,n){return"function"==typeof n?n(e,t):(n.forEach(function(n){e=n(e,t)}),e)}function u(e){return 200<=e&&e<300}function i(e,t,n){var r=Object.keys(e);return r.forEach(function(r){t.call(n,e[r],r)}),r}function a(e,t){if(!t)return e;var n,r,o,s=[];return n=t,r=function(e,t){null!=e&&(Array.isArray(e)||(e=[e]),e.forEach(function(e){"object"==typeof e&&(e=JSON.stringify(e)),s.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}))},Object.keys(n).sort().forEach(function(e){r.call(o,n[e],e)}),e+(-1==e.indexOf("?")?"?":"&")+s.join("&")}t.xhr=function(c){var f=t.xhr.defaults,p={transformRequest:f.transformRequest,transformResponse:f.transformResponse},d=function(e){var t,o,s,u=f.headers,a=n({},e.headers),c=function(e){i(e,function(t,n){if("function"==typeof t){var r=t();null!=r?e[n]=r:delete e[n]}})};c(u=n({},u.common,u[r(e.method)])),c(a);e:for(t in u){for(s in o=r(t),a)if(r(s)===o)continue e;a[t]=u[t]}return a}(c);n(p,c),p.headers=d,p.method=(p.method||"GET").toUpperCase();var h=function(e){return e.data=s(e.data,e.headers,p.transformResponse),u(e.status)?e:t.reject(e)},l=t.when(p);return t.xhr.interceptors.filter(function(e){return!!e.request||!!e.requestError}).map(function(e){return{success:e.request,failure:e.requestError}}).concat({success:function(n){d=n.headers;var c=s(n.data,o(d),n.transformRequest);return null==n.data&&i(d,function(e,t){"content-type"===r(t)&&delete d[t]}),null==n.withCredentials&&null!=f.withCredentials&&(n.withCredentials=f.withCredentials),(p=n,l=c,x=t.defer(),R=x.promise,q=a(p.url,p.params),j=new e,t.xhr.pendingRequests.push(p),j.open(p.method,q,!0),i(p.headers,function(e,t){e&&j.setRequestHeader(t,e)}),j.onreadystatechange=function(){if(4==j.readyState){var e,n;-1!==m&&(n=j.getAllResponseHeaders(),e=j.responseType?j.response:j.responseText),y&&clearTimeout(y),m=m||j.status,j=null,m=Math.max(1223==m?204:m,0);var r=t.xhr.pendingRequests.indexOf(p);-1!==r&&t.xhr.pendingRequests.splice(r,1),(u(m)?x.resolve:x.reject)({data:e,status:m,headers:o(n),config:p})}},j.onprogress=function(e){x.notify(e)},p.withCredentials&&(j.withCredentials=!0),p.responseType&&(j.responseType=p.responseType),j.send(l||null),p.timeout>0&&(y=setTimeout(function(){m=-1,j&&j.abort()},p.timeout)),R).then(h,h);var p,l,m,y,x,R,q,j}}).concat(t.xhr.interceptors.filter(function(e){return!!e.response||!!e.responseError}).map(function(e){return{success:e.response,failure:e.responseError}})).forEach(function(e){l=l.then(e.success,e.failure)}),l};var c={"Content-Type":"application/json;charset=utf-8"};return t.xhr.defaults={transformResponse:[function(e,t){return"string"==typeof e&&e.length&&(t("content-type")||"").indexOf("json")>=0&&(e=JSON.parse(e)),e}],transformRequest:[function(e){return e&&"object"==typeof e&&"[object File]"!==e.toString()?JSON.stringify(e):e}],headers:{common:{Accept:"application/json, text/plain, */*"},post:c,put:c,patch:c}},t.xhr.interceptors=[],t.xhr.pendingRequests=[],["get","delete","head"].forEach(function(e){t.xhr[e]=function(r,o){return t.xhr(n(o||{},{method:e,url:r}))}}),["post","put","patch"].forEach(function(e){t.xhr[e]=function(r,o,s){return t.xhr(n(s||{},{method:e,url:r,data:o}))}}),t});